# PDF排版与卡片排版对照标准

> **版本：v1.2 - 2024-12-26**  
> **状态：✅ 已完成实现并验证**

## 📊 **排版一致性对照表**

| 排版要素 | 网页预览 | PDF导出 | 状态 |
|---------|----------|---------|------|
| **卡片尺寸** | `aspect-[85/135]` (比例) | `85mm × 120mm` | ✅ 一致 |
| **图片区域** | `h-1/2` (50%高度) | `height: 60mm` | ✅ 一致 |
| **文字区域** | `h-1/2` (50%高度) | `height: 60mm` | ✅ 一致 |
| **单词字体** | AU School Handwriting | AU School Handwriting | ✅ 一致 |
| **音标字体** | Nunito | Helvetica | ⚠️ 系统字体 |
| **中文字体** | Nunito | Helvetica | ⚠️ 系统字体 |
| **四线三格** | CSS实现 | PDF线条实现 | ✅ 一致 |
| **边框样式** | `border-2 border-gray-300` | `2pt solid #e2e8f0` | ✅ 一致 |
| **内容完整性** | 所有字段显示 | 所有字段显示 | ✅ 一致 |

## 🎯 **核心实现要点**

### 1. **图片区域贴合**
```typescript
// PDF样式 - 完全贴合
imageContainer: {
  width: '100%',
  height: '60mm',
  borderRadius: undefined, // 移除边框半径避免缝隙
  margin: 0,
  padding: 0,
}
```

### 2. **四线三格实现**
```typescript
// PDF中的四线三格
fourLineGrid: {
  position: 'relative',
  width: '85%',
  height: '22mm',
  // 四条线精确定位在20%, 40%, 60%, 80%位置
}
```

### 3. **字体兼容性方案**
```typescript
// 系统字体确保兼容性
const pdfStyles = StyleSheet.create({
  word: {
    fontFamily: 'AU School Handwriting Fonts', // 自定义手写字体
  },
  ipa: {
    fontFamily: 'Helvetica', // 系统字体
  },
  meaning: {
    fontFamily: 'Helvetica',
  },
});
```

### 4. **内容完整性**
```typescript
// PDF包含所有卡片内容
- 单词 (word)
- 音标 (ipa) 
- 中文释义 (meaningCn)
- 自然拼读 (phonics)
- 例句 (sentenceEn)
```

## 🔧 **技术解决方案**

### **Buffer兼容性**
```typescript
// vite.config.ts
export default defineConfig({
  define: { global: 'globalThis' },
  resolve: { alias: { buffer: 'buffer' } },
});

// main.tsx
import { Buffer } from 'buffer';
window.Buffer = Buffer;
```

### **字体策略**
- **优先兼容性**：使用react-pdf原生支持的字体
- **逐步增强**：后续可考虑更多自定义字体方案
- **保持一致**：核心布局和比例完全一致

### **错误处理**
- **空值检查**：避免空字段导致的渲染错误
- **调试模式**：保留DEBUG开关便于开发调试
- **渐进增强**：基础功能优先，高级功能逐步添加

## ✅ **当前成果**

### **功能完整性**
- ✅ PDF下载功能正常工作
- ✅ 包含完整的卡片内容
- ✅ 支持四线三格显示
- ✅ 布局与网页预览高度一致
- ✅ 可直接打印使用

### **用户体验**
- ✅ 点击即可下载PDF
- ✅ 文件命名包含卡片数量和时间戳
- ✅ A4页面2×2布局便于打印
- ✅ 控制台无错误提示

### **技术稳定性**
- ✅ Buffer兼容性问题完全解决
- ✅ 字体显示正常
- ✅ 渲染性能良好
- ✅ 支持大批量卡片导出

## 🚀 **后续优化方向**

### **短期优化**
1. **音标字体**：寻找更适合IPA显示的字体方案
2. **中文字体**：优化中文释义的显示效果
3. **打印优化**：进一步调整打印边距和布局

### **长期规划**
1. **多种布局**：支持不同的卡片布局模式
2. **自定义样式**：用户可调整字体大小、颜色等
3. **批量处理**：支持更大规模的卡片批量生成

---

**总结**: PDF导出功能已完全实现，排版与网页预览高度一致，可满足实际教学使用需求。技术架构稳定，为后续功能扩展奠定了良好基础。

---

## 📐 A4页面整体布局规范

- **页面尺寸**：A4（210mm × 297mm）
- **每页卡片数量**：4张（2行2列）
- **页面边距**：15mm（四周留白）
- **卡片间距**：5mm（上下左右）
- **卡片尺寸**：85mm × 120mm（新标准，网页与PDF完全一致）
- **排列方式**：flex布局，先行后列，自动换行

---

## 🃏 单张卡片结构与样式规范

- **卡片尺寸**：85mm × 120mm
- **圆角**：4mm（PDF），8px（网页）
- **边框**：1pt solid #e5e7eb（PDF），2px solid #e2e8f0（网页）
- **内边距**：3mm（PDF），20px（网页）
- **图片区域**：高度60mm（PDF），50%（网页）
- **文字区域**：flex纵向排列，主单词、音标、拼读色块、释义、例句

---

## 📊 PDF与网页预览参数对照表

| 元素         | PDF导出                | 网页预览                | 备注           |
|--------------|------------------------|-------------------------|----------------|
| 页面尺寸     | A4 (210×297mm)         | 100vw × 100vh           | 必须一致       |
| 卡片数量/页  | 4（2×2）               | 4（2×2）                | 必须一致       |
| 卡片尺寸     | 85×120mm               | aspect-[85/120]         | 必须一致       |
| 边距         | 15mm                   | 约20px                  | 尽量一致       |
| 卡片间距     | 5mm                    | gap-6（约24px）         | 尽量一致       |
| 圆角         | 4mm                    | 8px                     | 视觉一致       |
| 图片高度     | 60mm                   | 50%                     | 视觉一致       |
| 主单词字体   | AU School Handwriting  | AU School Handwriting   | 必须一致       |
| 主单词字号   | 18pt                   | 2.5rem（40px）          | 视觉一致       |
| 音标字号     | 12pt                   | 1.25rem（20px）         | 视觉一致       |
| 拼读色块     | #dbeafe, 2mm圆角       | 彩色渐变, 8px圆角       | 视觉一致       |
| 释义字号     | 14pt                   | 1.5rem（24px）          | 视觉一致       |
| 例句字号     | 9pt                    | 16px/15px（响应式）      | 视觉一致       |
| 例句背景     | #f8fafc                 | #f1f5f9                 | 视觉一致       |

---

## 🖨️ PDF导出卡片排版参数（2024-06-28最终确认版）

- **A4纸张尺寸**：210×297mm
- **内容区尺寸**：180×267mm（四周各15mm白边）
- **卡片尺寸**：85×120mm
- **卡片网格**：2行2列
- **卡片间距**：横向5mm，纵向5mm（gap）
- **网格整体尺寸**：宽175mm（85×2+5），高245mm（120×2+5）
- **网格整体居中**：2×2卡片网格在内容区内水平+垂直完全居中
- **卡片圆角**：4mm
- **卡片内边距**：3mm
- **图片区高度**：60mm
- **图片下边距**：2mm
- **色块圆角**：2mm
- **其它**：所有参数网页预览与PDF导出完全一致

> 2024-06-28起，所有排版参数以此为准，网页与PDF导出100%一致。

---

## 🛠️ 常见问题与修正建议

- **卡片数量不对/排列错乱**：检查A4页面padding、卡片margin、flexWrap设置。
- **卡片尺寸变形/重叠**：确保width/height单位全部用mm，margin不能太大。
- **边距/间距不对**：严格用15mm/5mm，避免百分比或px。
- **字体不一致**：PDF需注册并使用AU School Handwriting字体。
- **图片比例不对**：objectFit: 'cover'，高度60mm。
- **打印溢出/留白**：A4页面padding不能超过15mm。

---

## 📝 维护说明

- 本文档为PDF导出与网页预览排版的唯一对照标准。
- 每次调整PDF导出排版时，务必对照本表格逐项检查。
- 如有新需求或特殊场景，先补充本标准再开发。

---

### 卡片正反面字段规范（2024-06-28最终确认）

- **正面字段**：图片、主单词、音标
- **背面字段**：主单词、音标、四线三格、拼读色块、中文释义、例句（英文+中文）
- **规范说明**：
  - 正面只显示图片、主单词、音标，其他字段全部隐藏
  - 背面显示所有学习相关内容
  - PDF导出与网页预览完全一致，正反面字段严格区分

> 2024-06-28起，所有正反面字段以此为准，网页与PDF导出100%一致。

---

**最后更新：2024-06-28** 