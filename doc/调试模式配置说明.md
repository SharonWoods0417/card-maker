# 调试模式配置说明

> **版本 v1.1 — 2024-12-26**  
> **🎯 MVP完成度：90% | 当前重点：PDF导出真实实现**  
> **专为小白用户准备的调试功能配置指南**

## 🚀 **当前项目状态**

### **✅ 已完成的功能（90%）**
- 调试模式系统已完整实现，包括环境变量控制、API统计监控等
- 所有核心功能（输入、补全、预览、API控制）都有完善的调试支持

### **🔥 当前最重要任务**
- **PDF导出真实实现**：这是MVP的最后一步，完成后即可投入使用
- **调试重点**：PDF生成过程的调试和错误处理

### **📋 调试建议**
- 在实现PDF功能时，充分利用调试模式查看API调用状态
- 遇到PDF相关问题时，检查控制台输出和API统计信息

---

## 🔧 调试模式功能说明

调试模式提供以下功能：
- **API使用统计监控**：实时显示OpenRouter和Pexels API的调用情况
- **缓存管理**：清空API调用缓存，强制重新请求
- **统计重置**：重置所有API调用计数和费用统计
- **调试信息输出**：在浏览器控制台显示调试日志

## ⚙️ 环境变量配置

### 创建环境变量文件

在项目根目录创建 `.env.local` 文件：

```bash
# ========================================
# 🔧 调试模式控制
# ========================================
# 是否开启调试模式（显示API统计的控制按钮）
# 开发环境建议设为 true，生产环境设为 false
VITE_DEBUG_MODE=true

# ========================================
# 🤖 OpenRouter API 配置（多模型支持）
# ========================================
VITE_OPENROUTER_API_KEY=sk-or-your-openrouter-key-here
VITE_OPENROUTER_MODEL=openai/gpt-3.5-turbo

# ========================================
# 📸 Pexels API 配置（可选）
# ========================================
VITE_PEXELS_API_KEY=your-pexels-key-here

# ========================================
# 🏗️ 环境设置
# ========================================
NODE_ENV=development
```

### 调试模式控制规则

调试模式的显示遵循以下优先级：

1. **环境变量优先**：`VITE_DEBUG_MODE=true` 时强制开启
2. **开发环境兜底**：在开发环境(`npm run dev`)中自动开启
3. **生产环境默认关闭**：在生产构建中默认关闭

## 🎯 调试控制按钮功能

### 清空缓存按钮
- **功能**：清空所有API调用缓存
- **作用**：下次调用相同单词时会重新请求API
- **使用场景**：
  - 测试API接口连通性
  - 强制获取最新数据
  - 调试缓存机制

### 重置统计按钮
- **功能**：重置所有API调用统计数据
- **作用**：清除今日和本月的API调用计数、费用统计
- **使用场景**：
  - 重新测试API限制
  - 清除错误的统计数据
  - 重置开发测试数据

## 🔒 代码安全标记

为防止误删调试相关代码，项目中使用了以下标记：

### App.tsx 中的标记
```typescript
// ========================================
// 🔧 调试模式控制配置
// ========================================
// 注意：以下代码块用于控制调试功能的显示
// ⚠️ 请勿删除或修改，除非明确需要禁用调试功能
```

### APIUsageDisplay.tsx 中的标记
```typescript
// ========================================
// 🔧 调试控制按钮区域
// ========================================
// ⚠️ 只在调试模式下显示，请勿删除条件判断
```

## 🚀 快速开启/关闭调试模式

### 开启调试模式
```bash
# 方法1：设置环境变量
echo "VITE_DEBUG_MODE=true" >> .env.local

# 方法2：开发环境会自动开启
npm run dev
```

### 关闭调试模式
```bash
# 方法1：设置环境变量为false
echo "VITE_DEBUG_MODE=false" >> .env.local

# 方法2：生产构建会自动关闭
npm run build
```

## 🔍 调试信息查看

### 浏览器控制台
开启调试模式后，打开浏览器开发者工具的控制台，可以看到：
- 🔧 调试模式状态信息
- 🔧 缓存清空确认
- 🔧 统计重置确认

### API统计界面
在页面顶部可以看到：
- API使用状况汇总
- 详细的调用统计和进度条
- 调试控制按钮（仅调试模式）

## ⚠️ 注意事项

1. **生产环境安全**：确保生产环境中 `VITE_DEBUG_MODE=false`
2. **API密钥保护**：`.env.local` 文件不会被Git追踪，确保密钥安全
3. **统计数据**：重置统计不会影响实际的API使用量，只清除本地记录
4. **缓存策略**：清空缓存会增加API调用次数，请谨慎使用

## 🔧 故障排除

### 调试按钮不显示
1. 检查 `.env.local` 文件中的 `VITE_DEBUG_MODE` 设置
2. 确认是否在开发环境中运行
3. 重启开发服务器

### 环境变量不生效
1. 确保 `.env.local` 文件在项目根目录
2. 重启开发服务器 (`npm run dev`)
3. 检查变量名是否以 `VITE_` 开头

### 控制台无调试信息
1. 打开浏览器开发者工具
2. 切换到 Console 标签页
3. 确认调试模式已开启 